# EveryLink (모링) - 프로젝트 개요

## 프로젝트 정보

**프로젝트명**: EveryLink (모링)
**플랫폼**: Flutter (Android/iOS)
**버전**: 1.0.0+1
**SDK**: Dart ^3.5.4

## 프로젝트 설명

EveryLink는 URL 북마크를 카테고리별로 관리하고 정리할 수 있는 모바일 앱입니다. 사용자는 링크를 저장하고, 카테고리를 지정하며, 메모를 추가하고, 특정 카테고리를 숨겨 링크를 필터링할 수 있습니다. 또한 Google AdMob을 통한 배너 광고가 통합되어 있습니다.

## 핵심 기능

### 1. 링크 관리
- URL 저장 및 편집
- 자동 메타데이터 수집 (페이지 제목, OG 이미지)
- 링크에 대한 사용자 메모 추가
- 링크 삭제 및 공유
- URL 클립보드 복사

### 2. 카테고리 시스템
- 카테고리별 링크 분류
- 하나의 링크에 여러 카테고리 지정 가능 (N:M 관계)
- 카테고리 표시/숨김 기능
- 카테고리 이름 변경 및 병합
- 카테고리별 통계 (링크 개수)
- 자동 완성 기반 카테고리 입력

### 3. 가시성 규칙
- 카테고리별 visible/invisible 플래그
- 하나의 링크에 연결된 카테고리 중 하나라도 invisible이면 해당 링크 전체가 숨겨짐
- 홈 화면: visible 링크만 표시
- 관리 화면: 모든 카테고리 표시 및 토글 가능

### 4. 검색 및 필터링
- 키워드 검색 (URL, 제목, 메모, 카테고리)
- 카테고리별 필터링
- TOP 5 인기 카테고리 표시
- 전체 카테고리 목록

### 5. 공유 및 수신
- 다른 앱에서 URL 공유 받기
- 저장된 링크를 다른 앱으로 공유
- 공유 인텐트 자동 처리

### 6. UI/UX
- 라이트/다크 모드 지원
- Material 3 디자인
- 브랜드 컬러: #16BEA8 (민트)
- Google Fonts 적용 (Noto Sans KR, Nunito)
- Pull-to-refresh
- 배너 광고 하단 통합

## 프로젝트 구조

```
lib/
├── app/                          # 앱 설정 및 테마
│   ├── app.dart                  # EveryLinkApp (루트 위젯)
│   ├── app_theme.dart            # 라이트/다크 테마 정의
│   └── theme_notifier.dart       # 테마 상태 관리 (Riverpod)
│
├── data/                         # 데이터 계층
│   ├── local_db.dart             # Drift 데이터베이스 (스키마 v3)
│   ├── local_db.g.dart           # Drift 생성 파일
│   └── repositories/
│       ├── link_repository.dart  # 링크/카테고리 리포지토리
│       └── suggestion_source.dart # (사용 안 함)
│
├── domain/                       # 도메인/비즈니스 로직
│   ├── constants.dart            # 상수 (kUncategorized 등)
│   ├── models.dart               # UrlItem 도메인 모델
│   └── services/
│       ├── ad_service.dart       # AdMob 배너 광고 서비스
│       ├── metadata_service.dart # 메타데이터 수집 (제목/OG)
│       └── normalize.dart        # URL/카테고리 정규화
│
├── logic/                        # 유틸리티
│   └── fuzzy.dart                # BK-tree 퍼지 매칭 (현재 미사용)
│
├── presentation/                 # UI 계층
│   ├── pages/
│   │   ├── home_page.dart        # 메인 홈 화면
│   │   └── category_manager_page.dart # 카테고리 관리 화면
│   ├── sheets/
│   │   └── add_link_sheet.dart   # 링크 추가/편집 바텀 시트
│   └── widgets/
│       ├── empty_hint.dart       # 빈 상태 힌트
│       └── link_tile.dart        # 링크 아이템 타일
│
└── main.dart                     # 앱 진입점
```

## 데이터베이스 아키텍처

### 스키마 버전: 3

Drift (SQLite) 기반으로 3개 테이블 구조:

#### 1. urls 테이블
- `id`: PRIMARY KEY
- `url`: TEXT (링크 URL)
- `title`: TEXT (페이지 제목, nullable)
- `memo`: TEXT (사용자 메모, nullable, v2+)
- `created_at`: DATETIME

#### 2. categories 테이블
- `id`: PRIMARY KEY
- `name`: TEXT (정규화된 카테고리명: 소문자 + trim)
- `used_count`: INTEGER (기본값 0, 현재 미사용)
- `note`: TEXT (카테고리 메모, nullable, v2+)
- `visible`: BOOLEAN (표시 여부, 기본값 true, v3+)

#### 3. url_categories 테이블 (junction)
- `url_id`: FOREIGN KEY → urls.id
- `category_id`: FOREIGN KEY → categories.id
- PRIMARY KEY: (url_id, category_id)

### 주요 데이터베이스 패턴

**1. 카테고리 정규화**
- 모든 카테고리명은 `normalize()` 함수로 소문자 변환 + trim
- 중복 방지

**2. Upsert 패턴**
- URL과 카테고리는 중복 체크 후 삽입 또는 업데이트
- 동일 URL/카테고리명이 여러 번 생성되지 않음

**3. 가시성 규칙 (v3)**
- CTE(Common Table Expression)를 사용한 visible_links 서브쿼리
- 링크에 연결된 카테고리 중 하나라도 `visible = 0`이면 해당 링크 제외

**쿼리 예시:**
```sql
WITH visible_links AS (
  SELECT u.id FROM urls u
  WHERE NOT EXISTS (
    SELECT 1 FROM url_categories uc2
    JOIN categories c2 ON c2.id = uc2.category_id
    WHERE uc2.url_id = u.id AND c2.visible = 0
  )
)
SELECT ... FROM urls u
JOIN visible_links vl ON vl.id = u.id
```

**4. 고아 카테고리 정리**
- `pruneOrphanCategories()`: url_categories에 매핑이 없는 카테고리 자동 삭제

**5. CASCADE 삭제**
- `deleteUrlCascade()`: URL 삭제 시 url_categories 매핑도 함께 삭제 + 고아 정리

## 주요 의존성

```yaml
dependencies:
  flutter_riverpod: ^2.5.0        # 상태 관리
  drift: ^2.18.0                  # SQLite ORM
  drift_sqflite: ^2.0.1           # Sqflite 백엔드
  google_mobile_ads: ^5.3.0       # AdMob 광고
  receive_sharing_intent: ^1.4.5  # 공유 인텐트 수신
  share_plus: ^10.1.2             # 링크 공유
  http: ^1.2.2                    # HTTP 요청
  html: ^0.15.4                   # HTML 파싱
  url_launcher: ^6.3.0            # 외부 브라우저 실행
  cached_network_image: ^3.3.1    # 이미지 캐싱
  google_fonts: ^6.2.1            # 폰트
  shared_preferences: ^2.2.2      # 로컬 설정
  path_provider: ^2.1.4           # 파일 경로

dev_dependencies:
  drift_dev: ^2.18.0              # Drift 코드 생성
  build_runner: ^2.4.10           # 코드 생성 러너
  flutter_launcher_icons: ^0.13.1 # 앱 아이콘
```

## 개발 명령어

```bash
# 의존성 설치
flutter pub get

# Drift 코드 생성 (데이터베이스 스키마 변경 시)
flutter pub run build_runner build --delete-conflicting-outputs

# 코드 분석
flutter analyze

# 앱 실행
flutter run

# 빌드 (Android)
flutter build apk
flutter build appbundle

# 빌드 (iOS)
flutter build ios
```

## 아키텍처 패턴

### Clean Architecture 기반 3계층 구조

1. **Presentation Layer** (`lib/presentation/`)
   - UI 위젯, 페이지, 바텀 시트
   - 상태 관리 (StatefulWidget, Riverpod)

2. **Domain Layer** (`lib/domain/`)
   - 비즈니스 로직
   - 도메인 모델 (UrlItem)
   - 서비스 (메타데이터, 광고, 정규화)

3. **Data Layer** (`lib/data/`)
   - 데이터베이스 (Drift)
   - 리포지토리 (데이터 접근 추상화)

### Repository 패턴
- `LinkRepository`가 `AppDatabase`를 래핑
- 카테고리 정규화, 가시성 쿼리 등 비즈니스 로직 캡슐화
- 인터페이스 추상화 없음 (복잡도 감소 위해 제거)

### 상태 관리
- Riverpod 사용 (테마 관리)
- 주로 StatefulWidget의 로컬 상태 활용

## 주요 서비스

### 1. MetadataService
- HTTP를 통한 페이지 메타데이터 수집
- OG 태그 및 HTML title 파싱
- 인메모리 캐싱 (최대 200개)
- 문자셋 감지 및 HTML 엔티티 디코딩

### 2. AdService
- Google AdMob 초기화 및 배너 광고 생성
- 테스트 ID 사용 중 (배포 전 실제 ID로 교체 필요)

### 3. Normalization Service
- `normalizeUrl()`: URL에 https:// 자동 추가
- `normalize()`: 카테고리명 소문자 변환 + trim
- `parseCategoriesInput()`: 쉼표로 구분된 카테고리 입력 파싱

## 테마 시스템

- Material 3 디자인
- 시스템/라이트/다크 모드 전환 가능
- 브랜드 컬러: `#16BEA8` (민트)
- Google Fonts: Noto Sans KR (본문), Nunito (타이틀)
- `AppTheme` 클래스에서 ColorScheme 정의

## 공유 인텐트 처리

### Android Manifest 설정
- `text/plain` MIME 타입
- `ACTION_SEND` 및 `ACTION_SEND_MULTIPLE` 지원
- 다른 앱에서 텍스트/URL 공유 시 자동으로 EveryLink 실행

### 앱 내 처리
- `receive_sharing_intent` 패키지 사용
- `getMediaStream()`: 앱 실행 중 공유 수신
- `getInitialMedia()`: 앱이 종료된 상태에서 공유로 실행
- URL 추출 후 자동으로 링크 추가 시트 열림

## 알려진 기술 부채

1. `lib/logic/fuzzy.dart` - BK-tree 퍼지 매칭 구현되어 있으나 현재 미사용
2. `WillPopScope` 사용 (deprecated, PopScope로 마이그레이션 필요)
3. 일부 BuildContext의 async gap 사용 (mounted 체크는 있음)
4. AdMob 테스트 ID 사용 중 → 배포 전 실제 ID로 교체 필요

## 배포 전 체크리스트

### AdMob 실제 ID 교체 필요
1. `lib/domain/services/ad_service.dart` - Banner Unit IDs
2. `android/app/src/main/AndroidManifest.xml` - APPLICATION_ID
3. `ios/Runner/Info.plist` - GADApplicationIdentifier

## 테스트

기본 위젯 테스트 존재 (`test/widget_test.dart`):
- 앱 타이틀 렌더링 테스트

```bash
flutter test
```

## Git 커밋 히스토리

```
* f72ea44 - v0: 저장된 링크 타 어플로의 공유 기능 추가
* bfab7e6 - v0: 구글 AdMob 추가 및 다크모드 추가
* 0d811d9 - v0: 프로젝트 구조 최신화 및 중복기능 제거
* 75c2ebd - v0: 링크 title 정규화 로직 수정
* 52c5843 - initial commit
```

## 브랜치 전략

- 메인 브랜치: `main`
- 현재 상태: Clean (변경사항 없음)
